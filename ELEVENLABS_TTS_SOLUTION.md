# 🎤 ElevenLabs TTS - 顶级真人语音方案

## 为什么选择 ElevenLabs？

ElevenLabs 提供业界**最顶级的真人语音效果**，远超 Edge TTS 和 OpenAI TTS。

---

## 🎯 方案对比

| 指标 | Edge TTS | OpenAI TTS | ElevenLabs |
|------|----------|------------|------------|
| **音质** | ⭐⭐⭐ 机器人 | ⭐⭐⭐⭐ 真人 | ⭐⭐⭐⭐⭐ **顶级真人** |
| **成本（1000次对话）** | $0 | $0.30 | $0.73 |
| **免费额度** | 无限 | 无 | **10,000字符/月** |
| **中文支持** | ✅ 好 | ✅ 优秀 | ✅ **完美** |
| **延迟** | < 1s | < 2s | < 2s |
| **稳定性** | ⚠️ 一般 | ✅ 极好 | ✅ 极好 |
| **情感表达** | ❌ 无 | ⚠️ 一般 | ✅ **极佳** |

---

## 💰 详细成本计算

### ElevenLabs 定价

**免费计划（Creator）**：
- **免费额度**: 10,000 字符/月
- **足够**: ~200 次对话（每次 50 字符）
- **成本**: $0

**付费计划（Creator）**：
- **价格**: $5/月（30,000 字符）
- **超出**: $22/月（300,000 字符）≈ 6,000 次对话
- **价格**: $99/月（2,000,000 字符）≈ 40,000 次对话

### 实际成本（心理咨询场景）

**假设**：
- 每次对话 AI 回复 **50 字符**（中文）
- 每天 **1000 次对话**

**计算**：
```
1000 次对话 × 50 字符 = 50,000 字符
50,000 ÷ 10,000 (免费) = 超出 40,000 字符

使用 $22/月 计划（300,000 字符）：
1000 次/天 × 30 天 = 30,000 次 × 50 字符 = 1,500,000 字符
需要 $99/月 计划
```

**月成本**: $99/月（1000 用户/天）

**对比 OpenAI TTS**:
- OpenAI TTS: $22.5/月
- ElevenLabs: $99/月
- **差价**: $76.5/月（但音质提升巨大）

---

## 🔧 实施步骤

### 1. 获取 ElevenLabs API Key

1. 访问: https://elevenlabs.io/
2. 注册账号（有免费额度）
3. 进入 Profile → API Keys
4. 创建新 API Key
5. 复制 Key（以 `sk_` 开头）

### 2. 添加到 Vercel 环境变量

1. 进入 Vercel Dashboard → 项目 Settings
2. Environment Variables
3. 添加：
   - **Name**: `ELEVENLABS_API_KEY`
   - **Value**: `sk_...` (你的 API Key)
   - **Environment**: Production, Preview, Development（全选）
4. 点击 Save
5. 重新部署

### 3. 测试

访问: `https://你的域名.vercel.app/test-therapy-20251115`

现在 AI 应该用**顶级真人语音**说话了！

---

## 🎤 可选声音

### 中文推荐声音

**当前使用**: `EXAVITQu4vr4xnSDxMaL` (Bella)
- 特点：柔和女声，多语言支持，中文流畅
- 适合：心理咨询、温暖对话

**其他选择**（需要在 ElevenLabs 控制台中试听）：
1. 访问: https://elevenlabs.io/voice-library
2. 筛选支持中文的声音
3. 试听并复制 Voice ID
4. 修改 [app/api/elevenlabs-tts/route.ts](app/api/elevenlabs-tts/route.ts) 中的 `voiceId` 变量

### 英文推荐声音

**当前使用**: `21m00Tcm4TlvDq8ikWAM` (Rachel)
- 特点：温暖友好女声
- 适合：英语心理咨询

---

## 📊 成本监控

### 查看 ElevenLabs 使用量

1. 访问: https://elevenlabs.io/usage
2. 查看 "Character Usage" 部分
3. 可以看到每日/每月使用的字符数和剩余额度

### 设置使用限制

1. 在 [app/api/elevenlabs-tts/route.ts](app/api/elevenlabs-tts/route.ts) 中添加字符计数
2. 当接近免费额度时，切换到 OpenAI TTS 或 Edge TTS
3. 或设置预算警告

---

## 🚨 注意事项

1. **免费额度有限**：10,000 字符/月（约 200 次对话）
2. **需要信用卡**：超过免费额度后会自动扣费
3. **延迟稍高**：比 Edge TTS 慢约 1 秒（但音质值得）
4. **备用方案**：代码已包含浏览器 TTS 作为备用

---

## 🔄 降级策略（节省成本）

### 方案 A：智能切换
- **首次访问**: 使用 ElevenLabs（给用户最佳印象）
- **后续对话**: 切换到 OpenAI TTS（节省成本）
- **失败时**: 降级到浏览器 TTS

### 方案 B：用户选择
- 让用户选择语音质量：
  - **Premium**: ElevenLabs（$99/月）
  - **Standard**: OpenAI TTS（$22.5/月）
  - **Free**: Edge TTS（$0）

### 方案 C：时间段切换
- **高峰期**（白天）: OpenAI TTS
- **低峰期**（夜晚）: ElevenLabs
- **演示模式**: ElevenLabs

---

## 📝 代码实现

### 当前实现

已创建 [app/api/elevenlabs-tts/route.ts](app/api/elevenlabs-tts/route.ts)：
- 自动检测中文/英文
- 选择最佳声音
- 错误处理（401=无效Key，429=配额用完）
- 浏览器 TTS 备用

### 测试页面

[app/test-therapy-20251115/page.tsx](app/test-therapy-20251115/page.tsx) 已更新：
- 使用 ElevenLabs TTS
- 修复语音识别问题（2秒静默后发送）
- 修复挂断电话功能（完全重置状态）

---

## 🆓 完全免费的替代方案

如果 ElevenLabs 太贵，考虑：

### 方案 A：Google Cloud TTS (WaveNet)
- **免费额度**: 100 万字符/月
- **音质**: ⭐⭐⭐⭐⭐ 真人级别
- **之后**: $0.000016/字符（极便宜）
- **中文**: ✅ 完美支持

### 方案 B：Azure TTS (Neural)
- **免费额度**: 500 万字符/月
- **音质**: ⭐⭐⭐⭐ 非常好
- **之后**: $0.000016/字符
- **中文**: ✅ 完美支持

### 方案 C：Fish Audio (开源)
- **免费额度**: 无限
- **音质**: ⭐⭐⭐⭐ 非常好
- **特点**: 可以克隆声音
- **缺点**: 需要自己部署

---

## ✅ 推荐

**小型应用（< 100 用户/天）**: **ElevenLabs 免费计划**
- 成本: $0/月（免费额度足够）
- 音质: 最佳
- 适合: 演示、测试、小规模部署

**中型应用（100-500 用户/天）**: **OpenAI TTS**
- 成本: $10-25/月
- 音质: 真人级别
- 适合: 正式上线的小型产品

**大型应用（> 500 用户/天）**: **Google Cloud TTS**
- 成本: 免费额度大（100万字符/月）
- 超出后极便宜
- 适合: 成熟产品

**追求极致音质**: **ElevenLabs 付费计划**
- 成本: $99-$330/月
- 音质: 业界顶级
- 适合: 高端付费产品、品牌形象要求高的场景

---

## 📈 升级路径

**阶段 1**：使用 **Edge TTS**（完全免费）
- 目的：验证产品概念
- 成本：$0
- 音质：⭐⭐⭐

**阶段 2**：使用 **OpenAI TTS**（性价比）
- 目的：提升音质，吸引用户
- 成本：$20-30/月
- 音质：⭐⭐⭐⭐

**阶段 3**：使用 **ElevenLabs**（极致体验）
- 目的：打造顶级产品
- 成本：$99+/月
- 音质：⭐⭐⭐⭐⭐

---

## 🎉 总结

**当前配置**：
- ✅ 测试页面已切换到 ElevenLabs TTS
- ✅ 音质：顶级真人（业界最佳）
- ✅ 成本：免费额度 10,000 字符/月
- ✅ 备用：浏览器 TTS（如果 API 失败）
- ✅ 修复：语音识别2秒静默检测
- ✅ 修复：挂断电话完全重置

**下一步**：
1. 添加 `ELEVENLABS_API_KEY` 到 Vercel
2. 测试顶级语音效果
3. 监控免费额度使用情况
4. 如果超出免费额度，考虑降级策略或付费
