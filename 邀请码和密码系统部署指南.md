# 🔐 邀请码 + 密码系统部署指南

## ✅ 已完成的修改

### 1️⃣ 数据库层
- ✅ affiliates 表添加 password_hash 字段
- ✅ 创建 affiliate_invite_codes 表
- ✅ 自动生成测试邀请码

### 2️⃣ API 层
- ✅ 注册 API：验证邀请码 + 密码加密
- ✅ 登录 API：邮箱 + 密码验证
- ✅ 邀请码管理 API：创建/查看/删除

### 3️⃣ 前端层
- ✅ 注册页面：添加邀请码和密码输入
- ✅ 登录页面：添加密码输入
- ✅ 密码确认验证

### 4️⃣ 佣金显示
- ✅ 从 "10%" 改为 "高达 50%"

---

## 🚀 部署步骤

### 第一步：执行数据库脚本

1. 打开 Supabase Dashboard
2. 进入 SQL Editor
3. 执行 `scripts/add-password-and-invites.sql`

**这个脚本会：**
- 添加密码字段
- 创建邀请码表
- 生成3个测试邀请码
- 为测试账号设置密码

### 第二步：提交并推送代码

```bash
git add -A
git commit -m "Add invite code and password system for affiliates"
git push origin main
```

### 第三步：等待 Vercel 部署
- Vercel 会自动检测更新
- 等待 2-5 分钟完成部署

---

## 🔑 测试信息

### 测试邀请码
1. **WELCOME2025** - 可用10次
2. **LAUNCH50** - 可用50次  
3. **TESTCODE** - 可用1次

### 已有测试账号（已添加密码）
- 邮箱：`influencer@test.com`
- 邮箱：`marketer@test.com`
- 密码：`Test123!`

---

## 🧪 测试流程

### 测试注册（新分销商）
1. 访问：`https://your-domain.vercel.app/affiliate/register`
2. 输入：
   - 邀请码：`WELCOME2025`
   - 邮箱：任意邮箱
   - 姓名：可选
   - 密码：至少6个字符
   - 确认密码：与密码一致
3. 点击注册
4. 查看是否成功创建

### 测试登录
1. 访问：`https://your-domain.vercel.app/affiliate/login`
2. 输入：
   - 邮箱：注册时的邮箱
   - 密码：注册时设置的密码
3. 点击登录
4. 应该能进入仪表板

### 测试后台管理
1. 访问：`https://your-domain.vercel.app/ad7m2in9/affiliates`
2. 应该能看到新注册的分销商
3. 可以编辑佣金比例等

---

## 🎯 后台生成邀请码

### 方法 1：直接在 Supabase 中创建

```sql
INSERT INTO public.affiliate_invite_codes (code, created_by, max_uses, status)
VALUES ('YOUR_CODE_HERE', 'admin', 10, 'active');
```

### 方法 2：使用 API（后续可添加UI）

```bash
curl -X POST https://your-domain.vercel.app/api/ad7m2in9/invite-codes \
  -H "Content-Type: application/json" \
  -d '{"maxUses": 10, "expiresInDays": 30}'
```

---

## 📋 邀请码管理（SQL 查询）

### 查看所有邀请码
```sql
SELECT code, max_uses, used_count, status, created_at 
FROM public.affiliate_invite_codes 
ORDER BY created_at DESC;
```

### 查看可用邀请码
```sql
SELECT code, (max_uses - used_count) as remaining_uses 
FROM public.affiliate_invite_codes 
WHERE status = 'active';
```

### 禁用邀请码
```sql
UPDATE public.affiliate_invite_codes 
SET status = 'expired' 
WHERE code = 'CODE_TO_DISABLE';
```

### 删除邀请码
```sql
DELETE FROM public.affiliate_invite_codes 
WHERE code = 'CODE_TO_DELETE';
```

---

## ⚙️ 邀请码设置说明

### code (邀请码)
- 8位大写字母+数字组合
- 自动生成，确保唯一
- 建议：有意义的词 + 数字（如 LAUNCH2025）

### max_uses (最大使用次数)
- 1 = 一次性邀请码
- 10 = 可供10人使用
- NULL或0 = 无限次使用

### status (状态)
- `active` - 可用
- `used` - 已用完
- `expired` - 已过期/已禁用

### expires_at (过期时间)
- NULL = 永不过期
- 设置日期 = 到期自动失效

---

## 🔐 密码安全

### 密码要求
- 最少6个字符
- 使用 bcrypt 加密存储
- Salt rounds: 10

### 密码验证
- 注册时：密码 + 确认密码必须一致
- 登录时：使用 bcrypt.compare 验证

---

## 🎨 后续优化建议

### 立即可用
1. ✅ 基本注册/登录已完成
2. ✅ 邀请码验证已完成
3. ✅ 密码加密已完成

### 后续可添加
1. 后台邀请码管理界面（可视化）
2. 批量生成邀请码功能
3. 邀请码使用统计
4. 密码重置功能
5. 邀请码使用记录

---

## ⚠️ 注意事项

1. **测试邀请码**
   - 测试完成后建议删除或禁用
   - 正式使用前创建新的邀请码

2. **密码安全**
   - 密码以加密方式存储
   - 无法找回原始密码
   - 只能重置密码

3. **邀请码管理**
   - 妥善保管邀请码
   - 定期检查使用情况
   - 及时删除无效邀请码

---

**创建日期：** 2025-11-09  
**系统版本：** v2.0 (邀请码+密码系统)  
**状态：** ✅ 就绪待部署

